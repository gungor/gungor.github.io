<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Using Spring Reactive WebClient instead of RestTemplate</title>
  <meta name="description" content="In the age of where resources are cheap, applications running on Prod environment still have resource problems (CPU, Memory). Threads were being used for par...">

  
  
  <link rel="stylesheet" href="http://localhost:4000/assets/style.css">

  <link rel="canonical" href="http://localhost:4000/article/2020/08/08/spring-webclient-where-is-subscriber.html">
  <link rel="alternate" type="application/rss+xml" title="Developer Discoveries" href="http://localhost:4000/feed.xml">

  <script async defer src="https://buttons.github.io/buttons.js"></script>

	<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-175162357-1', 'auto');
 ga('send', 'pageview');
</script>
 
</head>


  <body>

    <header class="border-bottom-thick px-2 clearfix">
  <div class="left sm-width-full py-1 mt-1 mt-lg-0">
    <a class="align-middle link-primary text-accent" href="/">
      Developer Discoveries
    </a>
  </div>
  <div class="right sm-width-full">
    <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
      
        
      
        
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="/about/">
            About
          </a>
        </li>
        
      
        
      
        
      
        
      
    </ul>
  </div>
</header>


    <div>
      <article class="container px-2 mx-auto mb4" itemscope itemtype="http://schema.org/BlogPosting">
  <h3 class="h3 col-9 sm-width-full py-4 mt-3 inline-block" itemprop="name headline">Using Spring Reactive WebClient instead of RestTemplate</h3>
  <div class="col-4 sm-width-full mt-1 border-top-thin ">
    <p class="mb-3 py-2 bold h4"><time datetime="2020-08-08T14:02:13+03:00" itemprop="datePublished">Aug 8, 2020</time></p>
  </div>

  <div class="prose" itemprop="articleBody">
      <p>In the age of where resources are cheap, applications running on Prod environment still have resource problems (CPU, Memory). Threads were being used for parallel processing
and are useful. However when they are used inefficiently, it still causes resource problem.</p>

<p>An example is when you call a webservice. As you wait for the response, your thread is blocked.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">RestTemplate</span> <span class="n">restTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RestTemplate</span><span class="o">();</span>
<span class="nc">HttpEntity</span><span class="o">&lt;</span><span class="nc">Request</span><span class="o">&gt;</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpEntity</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="nc">Request</span><span class="o">(</span><span class="s">"test"</span><span class="o">));</span>
<span class="n">restTemplate</span><span class="o">.</span><span class="na">postForObject</span><span class="o">(</span><span class="s">"http://localhost:8080/testService"</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="nc">Request</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

<p>If RestTemplate called in a separate thread, you will need to wait for this thread to complete as long as RestTemplate receives a response from IO operation.
Consider that, you need to call 1000 times an HTTP service concurrently. You need 1000 Threads to run and wait for its RestTemplate blocking call.
It will degrade significantly performance of your application.</p>

<p>Reactive clients (WebClient) brings a solution to that increasing number of thread problem. WebClient is a part of Spring Reactor project. 
Spring Reactor uses Event-Loop mechanism by using fixed number of threads. As the number of your http calls increase fixed number of threads (number of cores by default)
handle IO operations.</p>

<p>As it is shown below, if webclient is used reactor-http-nio threads are created as many as the number of cpus in your machine. 
If you have 4 cores, 4 io.netty.channel.nio.NioEventLoop instances and 4 reactor-http-nio threads are created and their number remain fixed even if concurrent WebClient calls increase.
You can see threads reactor-http-nio threads in VisualVM.</p>

<p><img src="/assets/reactor-nio-threads.PNG" alt="Reactor nio threads" />
<br /><br /><br /><br /></p>

<p>Here, Netty is used in Spring Reactor. Netty is responsible for handling non blocking http calls. There also alternatives such as Jetty, Undertow, vs.
Success and error callbacks are handled in reactor-http-nio threads.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpEntity</span><span class="o">&lt;</span><span class="nc">Request</span><span class="o">&gt;</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpEntity</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="nc">Request</span><span class="o">(</span><span class="s">"test"</span><span class="o">));</span>
 <span class="n">webClient</span><span class="o">.</span><span class="na">post</span><span class="o">()</span>
                <span class="o">.</span><span class="na">uri</span><span class="o">(</span> <span class="s">"http://localhost:8080/testService"</span> <span class="o">)</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="nc">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">request</span><span class="o">),</span> <span class="nc">Request</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
                <span class="o">.</span><span class="na">exchange</span><span class="o">()</span>
                <span class="o">.</span><span class="na">doOnSuccess</span><span class="o">(</span> <span class="o">(</span><span class="nc">ClientResponse</span> <span class="n">clientResponse</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="c1">// response can be processed here asynchronously</span>
		    <span class="c1">// one of reactor-http-nio handles this block</span>
                <span class="o">})</span>
                <span class="o">.</span><span class="na">doOnError</span><span class="o">(</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">error</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="c1">// error can be processed here asynchronously</span>
		    <span class="c1">// one of reactor-http-nio handles this block</span>
                <span class="o">})</span>
                <span class="o">.</span><span class="na">subscribe</span><span class="o">();</span></code></pre></figure>


  </div>

</article>

<div class="container mx-auto px-2 py-2 clearfix">
  <!-- Use if you want to show previous and next for all posts. -->



  <div class="col-4 sm-width-full left mr-lg-4 mt-3">
    <a class="no-underline border-top-thin py-1 block" href="http://localhost:4000/article/2019/01/18/how-to-check-process-running-linux.html">
      <span class="h5 bold text-accent">Previous</span>
      <p class="bold h3 link-primary mb-1">Check Process Status Using Parameters in Linux</p>
      <p>When you have a lot of processes running in your machine, you often check your if application running using ps...</p>
    </a>
  </div>
  
  

</div>

    </div>

    <div class="border-top-thin clearfix mt-2 mt-lg-4">
  <div class="container mx-auto px-2">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/gungor">gungor</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="Developer Discoveries">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/gungor/" data-icon="octicon-star" data-count-href="gungor//stargazers" data-count-api="/repos/gungor/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star gungor/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>

</html>
